<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A QR driven advent calender">
    <meta name="author" content="Rich Bradish">
<style>
	.imageClip{
    width:100%;
    height: auto;
    overflow:hidden;
}
</style>
   <title>Advent Calender</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
  </head>
<body onLoad=loadHandler()>
<script type = 'text/javascript'>
var success = "You found a clue:<br>";
var unknown = "I don't have a clue!";
var broken = "No, no, no, no, NO! Hit Rich. It's OK, I said to."
var confused = "Try entering a four letter / number code - should be all caps.";
var clues = new Array();
var keys = new Array();

weak = /\?code=/;
matcher = /\?code=([A-Z0-9]{4})$/;
alphabet = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!,.;:-()@ /<>'=_&?{}";

keys[0]="JGOE"
keys[1]="HKLR"
keys[2]="JHTD"
keys[3]="IRDJ"
keys[4]="IF3H"
keys[5]="IO5G"
keys[6]="ORFG"
keys[7]="KI6F"
keys[8]="94FJ"
keys[9]="O9WG"
keys[10]="U5RG"
keys[11]="8RGI"
keys[12]="U652"
keys[13]="783F"
keys[14]="5YHF"
keys[15]="4YBR"
keys[16]="9FFG"
keys[17]="8955"
keys[18]="G764"
keys[19]="0UOW"
keys[20]="KC2A"
keys[21]="63XK"
keys[22]="DBN3"
keys[23]="ZBU3"
keys[24]="S1T5"


clues[0] = "C9a=;CWQPAQPJY7yIAMMVGUIzXSWYU2WR2SyRSOKN9ZMYAQSUwZKzkMy2XQDHN8XYYDzE3!1wM3SPRSrLUBYTBWQJMSWEY6T1BZSPUpf6t4RPEL"
clues[1] = "F.cr,eYQ1RPQZON6UNKUH9K6MJ:VJOXSL2F"
clues[2] = "H0kd;b7C3OXC3O2UMGWD8G8II!XFNTUH1B"
clues[3] = "G :j.lQI2YHIN6X12YCMI-CXNQ7NKVPKM9x"
clues[4] = "G8th. -G2M7GNN81PE6H7E(MH97JMR4LZz"
clues[5] = "G(vg.i)F2V9F1WhZPN8G7N@LH)9IM16KZI"
clues[6] = "M (g@lSF8YJF7V1K2!MFRR4F3WE0STJSPVWA"
clues[7] = "I!wf:c@E4P0EOQ,YRH9F9H KJ,0HOU7J2C"
clues[8] = "7l(jsxSIh!JIb,S3-3IJm3TO8mJL.-GNfX"
clues[9] = "Mqng@C0F8-1F8.0ZV8ZG.8!LNr1ISaXK63"
clues[10] = "Smigey5F;,VFY-V2Y)!NT8R5T@WFd9TK76VXO"
clues[11] = "6 )irlTHgYKHg;KTgYFL8-FW.Q0M0VSJ,9A"
clues[12] = "SnvBez)1;.91;..@;09:;.45Uj4-Z5n6W0(3YcY"
clues[13] = "5ptfqB-Ef:7E,b Y!,-Y;76Fk7(K6q7H! 4Jd2"
clues[14] = "3g@fosUEd6LE071J9,1M42H44.MEn3JJ(ZLWY"
clues[15] = "2g.rnsOQc6FQb7Y!83O!!XERhXPW3hFT8!CVaS"
clues[16] = "78(gs SFhMJFgJ1KbYJKhMEJ94EU;E9K!JRH.Wz"
clues[17] = "6qvErC)4g-94,(!,g.9)g-488m4@.8n90.(6,fY"
clues[18] = "EowD!A@3Z;03T:@8Z!0(Z;57Gk5)L6o8I!)5KdZ"
clues[19] = "8cfwto2Vi2SVi(S0i3S-(TRWnT329dSY;7P1gO"
clues[20] = "I5sa:(:z4J6z4Y6N41WFST TJF2YJQ7z;G4EWD6RE"
clues[21] = "4kokpw!Je02Jee2XegS305,X921Kj2,P5l2M0:YOcW"
clues[22] = "B4eC8-12WIR2WXR-WZIbKJ56CENgCPS27FP7PCR x"
clues[23] = "X4lCj-82hI,!)U73)Aed4v"
clues[24] = "QikEcu74a8!.! 65!Zc5(U"

function loadHandler(){
	if(weak.test(location.href)){
		if(matcher.test(location.href)){
			var match = matcher.exec(location.href)[1]
			checkCode(match);
		}
		else{
			showAnswer(confused);
		}
	}
}
function checkCode(match){
	found = false;
	for(k=0;k<clues.length;k++){
		if("@CLUE"==decoder(clues[k].substr(0,5),match)){
			hideForm()
			//JSON and the arg[0]
			try{
				var obj = eval(decoder(clues[k],match).substr(5))
				HTMLanswer = ""+
				"<h3>"+obj.caption+"</h3>"
				"<img class = 'img-responsive imgClip' src='"+obj.src+"'>"
				showAnswer(HTMLanswer)
			}
			catch(e){
				showAnswer(broken)
			}
			found = true;
			break;
		}
	}
	if(!found){
		showAnswer(unknown)
	}
}
function hideForm(){
	document.getElementById("form").style.visibility = "hidden"
}

function showAnswer(text){
	document.getElementById("answer").innerHTML = text;
	document.getElementById("answer").style.visibility = "visible"
}

function printAll(){
	document.write("<table>");
	for(i=0;i<keys.length;i++){
		document.write("<tr><td><img src = 'http://qrcode.kaywa.com/img.php?s=2&d=http%3A%2F%2Fbradi.sh%2Fcode.html%3Fcode%3D"+keys[i]+"'></td><td><b>"+keys[i]+"</b><br></td></tr>");
	}
	document.write("</table>");
}

function encoder(text,key){
	return coder(text,key,1)
}
function decoder(text,key){
	return coder(text,key,-1)
}

function coder(text,key,direction){
	out = ""
	//chomp through the text, through the key, performing a modulus rotation through the 'alphabet'
	for(j=0;j<text.length;j++){
		if(alphabet.indexOf(text.substring(j,j+1))!=-1&&alphabet.indexOf(key.substring((j%key.length),(j%key.length)+1))!=-1){
			//encode the jth letter with the j mod key.length part of the key, then spit it back out
			out = out + alphabet.substr(
					(
						alphabet.indexOf(
							text.substring(j,j+1)
						)
						+alphabet.indexOf(
							key.substring(
								(j%key.length),(j%key.length)+1
							)
						)*direction
						+
						alphabet.length
					)%alphabet.length,
					1)
		}
		else{
			return "";
		}
	}
	return out
}
document.write("<br>clues[0] = \""+encoder("@CLUE{day:1, caption:'Even if you&apos;re obsessed with tea', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbWmN3M2JFVWUyRkU/view?usp=sharing'}",keys[0])+"\"");
document.write("<br>clues[1] = \""+encoder("@CLUE{day:2, caption:'.. ok, not <i>all</i> tea', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbemdhOWY4T1c4UWc/view?usp=sharing'}",keys[1])+"\"");
document.write("<br>clues[2] = \""+encoder("@CLUE{day:3, caption:'Even if you&apos;re a slow cyclist', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbbW51clJoM0pSMzQ/view?usp=sharing'}",keys[2])+"\"");
document.write("<br>clues[3] = \""+encoder("@CLUE{day:4, caption:'Even if you&apos;re always selling current accounts', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbOE5MUkltcHYxM2c/view?usp=sharing'}",keys[3])+"\"");
document.write("<br>clues[4] = \""+encoder("@CLUE{day:5, caption:'Even if you need an extra coat', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbN1VVcW9UWC1MWlU/view?usp=sharing'}",keys[4])+"\"");
document.write("<br>clues[5] = \""+encoder("@CLUE{day:6, caption:'Even if you struggle to keep your eyes open ;)', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbTkE4ZTNQZ1FaM1E/view?usp=sharing'}",keys[5])+"\"");
document.write("<br>clues[6] = \""+encoder("@CLUE{day:7, caption:'Even if you&apos;re always lost', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbV0ttelllNHNpUEU/view?usp=sharing'}",keys[6])+"\"");
document.write("<br>clues[7] = \""+encoder("@CLUE{day:8, caption:'Even if you&apos;re sometimes late', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbTlY1SGpkeGhxRk0/view?usp=sharing'}",keys[7])+"\"");
document.write("<br>clues[8] = \""+encoder("@CLUE{day:9, caption:'Even if you have slightly crazy hair', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbOUEtRHRGYURmSGs/view?usp=sharing'}",keys[8])+"\"");
document.write("<br>clues[9] = \""+encoder("@CLUE{day:10, caption:'Even if you&apos;re terrible with busses', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbVF9zM0JMcVFvNUU/view?usp=sharing'}",keys[9])+"\"");
document.write("<br>clues[10] = \""+encoder("@CLUE{day:11, caption:'I don&apos;t want this to sound too gushing but…', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbSzFVR2FXcHVvbjQ/view?usp=sharing'}",keys[10])+"\"");
document.write("<br>clues[11] = \""+encoder("@CLUE{day:12, caption:'I think we&apos;re the perfect match', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbQURuOTZhbVZ5cFU/view?usp=sharing'}",keys[11])+"\"");
document.write("<br>clues[12] = \""+encoder("@CLUE{day:13, caption:'We look out for each other', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbZC13bUl5LXpidHc/view?usp=sharing'}",keys[12])+"\"");
document.write("<br>clues[13] = \""+encoder("@CLUE{day:14, caption:'We&apos;re making a wonderful home together', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbaUpwZXJ6OHE2VGs/view?usp=sharing'}",keys[13])+"\"");
document.write("<br>clues[14] = \""+encoder("@CLUE{day:15, caption:'We have great adventures at home', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbTzFPU19peWRFUWM/view?usp=sharing'}",keys[14])+"\"");
document.write("<br>clues[15] = \""+encoder("@CLUE{day:16, caption:'… and great adventures abroad', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbZ1h1LU55U09MWWc/view?usp=sharing'}",keys[15])+"\"");
document.write("<br>clues[16] = \""+encoder("@CLUE{day:17, caption:'So here&apos;s to us', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbelplTENYTVZ5MFk/view?usp=sharing'}",keys[16])+"\"");
document.write("<br>clues[17] = \""+encoder("@CLUE{day:18, caption:'And hats off to you', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbRHRiWFcxV1RvNms/view?usp=sharing'}",keys[17])+"\"");
document.write("<br>clues[18] = \""+encoder("@CLUE{day:19, caption:'I hope we&apos;re saddled with each other for a long time', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbb21paHdGV1Zad3c/view?usp=sharing'}",keys[18])+"\"");
document.write("<br>clues[19] = \""+encoder("@CLUE{day:20, caption:'For more great meals', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbUldyZnJpNUtfNms/view?usp=sharing'}",keys[19])+"\"");
document.write("<br>clues[20] = \""+encoder("@CLUE{day:21, caption:'For more great wine', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbcmhKOXQ0bTNYeXc/view?usp=sharing'}",keys[20])+"\"");
document.write("<br>clues[21] = \""+encoder("@CLUE{day:22, caption:'For more adventures', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbV0RYLXpRSXRqQzg/view?usp=sharing'}",keys[21])+"\"");
document.write("<br>clues[22] = \""+encoder("@CLUE{day:23, caption:'For more *ahem*', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbM2pMR1BOeUtMcVU/view?usp=sharing'}",keys[22])+"\"");
document.write("<br>clues[23] = \""+encoder("@CLUE{day:24, caption:'I love you very much', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbMU5yQlU4d3BmbmM/view?usp=sharing'}",keys[23])+"\"");
document.write("<br>clues[24] = \""+encoder("@CLUE{day:25, caption:'Happy Christmas, Megan!', src:'https://drive.google.com/file/d/0B_8OG3Rr6nHbSy1RRnpuMG9lNjA/view?usp=sharing'}",keys[24])+"\"");
/*document.write("<br>clues[24] = \""+encoder("@CLUEOn Christmas Day:",keys[24])+"\"");*/
//printAll();
</script>
	<div class="container">
      <div class="header">
        <h3 class="text-muted">Advent calendar</h3>
      </div>
		<div class="col-xs-6">
			<form action = 'code.html' method = 'get'>
				<div class="panel panel-info">
					<div class="panel-heading">
						<h3 class="panel-title">Today is...</h3>
            				</div>
            				
            				<div class="panel-body">
	           				<div class="col-xs-4">
	           					<div id = 'answer' style = 'visibility:hidden;'></div>
	           				</div>
	           				<div class="col-xs-4" id = "form">
	           				<p><input type = 'text' id = 'code' name = 'code' class="form-control"></p>
	           				<p><input type = 'submit' value = 'Check it!' class="btn btn-lg btn-default" onclick = 'checkCode(document.getElementById("code").value)'></p>
						</div>
					</div>
					</div>
				</div>
			</form>
		</div>
	</div>
  </body>
</html>
